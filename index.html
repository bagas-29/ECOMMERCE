<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-StarMart - Belanja Cerdas & Lengkap</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; scroll-behavior: smooth; }
        .cart-modal { transition: transform 0.3s ease-in-out; }
        #cartItems::-webkit-scrollbar { width: 5px; }
        #cartItems::-webkit-scrollbar-thumb { background: #2563eb; border-radius: 10px; }
        .modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .product-card { transition: all 0.2s ease; }
        .product-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        .cat-active {
            background-color: #2563eb !important;
            color: white !important;
            border-color: #2563eb !important;
        }

        .payment-radio:checked + label {
            border-color: #2563eb;
            background-color: #eff6ff;
            color: #1e40af;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Navigasi -->
    <nav class="bg-white shadow-sm sticky top-0 z-50 border-b border-blue-100">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2 cursor-pointer" onclick="setActiveCategory('All')">
                <div class="bg-blue-600 p-2 rounded-lg text-white">
                    <i class="fas fa-star"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-800 tracking-tight">E-Star<span class="text-blue-600">Mart</span></h1>
            </div>
            
            <div class="flex items-center space-x-4">
                <button onclick="toggleCart()" class="relative p-2 text-gray-600 hover:text-blue-600 focus:outline-none transition">
                    <i class="fas fa-shopping-cart text-2xl"></i>
                    <span id="cart-count" class="absolute top-0 right-0 bg-yellow-500 text-white text-[10px] rounded-full h-5 w-5 flex items-center justify-center font-bold border-2 border-white">0</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Bagian Hero -->
    <header class="relative bg-blue-600 text-white py-10 overflow-hidden">
        <div class="container mx-auto px-4 text-center relative z-10">
            <h2 class="text-2xl md:text-3xl font-extrabold mb-2 text-yellow-300">Bintangnya Belanja Online!</h2>
            <p class="text-sm mb-6 opacity-90 max-w-2xl mx-auto text-blue-50">Temukan layanan hiburan & kebutuhan harian dengan harga terbaik hanya di <b>E-StarMart</b>.</p>
            <div class="max-w-xl mx-auto flex bg-white rounded-2xl p-1 shadow-lg">
                <input type="text" id="searchInput" onkeyup="searchProduct()" placeholder="Cari layanan streaming atau produk..." class="flex-grow px-4 py-2.5 rounded-xl text-gray-800 focus:outline-none text-sm">
                <div class="bg-blue-600 px-5 py-2.5 rounded-xl flex items-center justify-center">
                    <i class="fas fa-search text-white"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Filter Kategori -->
    <section class="py-4 bg-white border-b sticky top-[65px] z-40">
        <div class="container mx-auto px-4">
            <div class="flex overflow-x-auto space-x-2 pb-2 no-scrollbar" id="categoryTabs">
                <!-- Tabs akan dibuat oleh JS -->
            </div>
        </div>
    </section>

    <!-- Konten Utama -->
    <main class="pb-20 pt-6">
        <div class="container mx-auto px-4">
            <div id="categoryHeader" class="mb-6">
                <!-- Judul Kategori Dinamis -->
            </div>
            <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Produk akan dibuat oleh JS -->
            </div>
        </div>
    </main>

    <!-- Sidebar Keranjang -->
    <div id="cartSidebar" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-2xl z-[60] transform translate-x-full cart-modal flex flex-col">
        <div class="p-6 border-b flex justify-between items-center bg-blue-50">
            <div>
                <h4 class="text-xl font-bold text-blue-800">Keranjang Belanja</h4>
                <p id="cart-summary-text" class="text-[10px] text-blue-600 font-medium italic">E-StarMart siap melayani Anda</p>
            </div>
            <button onclick="toggleCart()" class="h-10 w-10 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-500 hover:text-red-500 transition"><i class="fas fa-times"></i></button>
        </div>
        <div id="cartItems" class="flex-grow overflow-y-auto p-4 space-y-3 bg-gray-50"></div>
        <div class="p-6 border-t bg-white shadow-inner">
            <div class="flex justify-between mb-1 text-sm text-gray-500">
                <span>Subtotal Barang</span>
                <span id="cartSubtotal" class="font-bold">Rp 0</span>
            </div>
            <div class="flex justify-between mb-2 text-sm text-gray-500">
                <span>Biaya Layanan</span>
                <span id="cartServiceFee" class="font-bold">Rp 0</span>
            </div>
            <div class="flex justify-between mb-4 text-lg border-t pt-2 font-extrabold text-blue-700">
                <span>Total Estimasi</span>
                <span id="cartTotalDisplay">Rp 0</span>
            </div>
            <button onclick="openCheckoutModal()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition shadow-lg shadow-blue-100">Checkout Sekarang</button>
        </div>
    </div>

    <!-- Modal Checkout -->
    <div id="checkoutModal" class="fixed inset-0 z-[70] hidden flex items-center justify-center px-4">
        <div class="absolute inset-0 modal-overlay" onclick="closeCheckoutModal()"></div>
        <div class="bg-white rounded-3xl w-full max-w-md relative z-10 overflow-hidden shadow-2xl">
            <div class="bg-blue-600 p-6 text-white text-center">
                <h4 class="text-xl font-bold">Data Pengiriman</h4>
                <p class="text-xs opacity-80">Lengkapi untuk konfirmasi E-StarMart</p>
            </div>
            <div class="p-6 space-y-4 max-h-[75vh] overflow-y-auto">
                <!-- Info Pengguna -->
                <div class="space-y-3">
                    <input type="text" id="custName" placeholder="Nama Lengkap" class="w-full bg-gray-100 border-none rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                    <div id="shippingArea" class="grid grid-cols-2 gap-4">
                        <input type="number" id="shipDistance" oninput="calculateShipping()" placeholder="Jarak (KM)" class="w-full bg-gray-100 border-none rounded-xl px-4 py-3 text-sm outline-none">
                        <input type="text" id="shippingFeeDisplay" value="Rp 0" disabled class="w-full bg-gray-200 border-none rounded-xl px-4 py-3 text-sm font-bold text-gray-500">
                    </div>
                    <textarea id="custAddr" rows="3" placeholder="Alamat Lengkap / Info Akun Digital (Email/No HP)..." class="w-full bg-gray-100 border-none rounded-xl px-4 py-3 text-sm outline-none"></textarea>
                </div>

                <!-- Metode Pembayaran -->
                <div class="space-y-2">
                    <p class="text-xs font-bold text-gray-500 uppercase ml-1">Metode Pembayaran</p>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="relative">
                            <input type="radio" name="payMethod" id="payCOD" value="COD" class="hidden payment-radio" checked>
                            <label for="payCOD" class="flex flex-col items-center justify-center p-3 border-2 border-gray-100 rounded-xl cursor-pointer hover:border-blue-200 transition">
                                <i class="fas fa-hand-holding-usd mb-1"></i>
                                <span class="text-[10px] font-bold">COD (Tunai)</span>
                            </label>
                        </div>
                        <div class="relative">
                            <input type="radio" name="payMethod" id="payTransfer" value="Transfer" class="hidden payment-radio">
                            <label for="payTransfer" class="flex flex-col items-center justify-center p-3 border-2 border-gray-100 rounded-xl cursor-pointer hover:border-blue-200 transition">
                                <i class="fas fa-university mb-1"></i>
                                <span class="text-[10px] font-bold">Transfer Bank</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Ringkasan -->
                <div class="bg-blue-50 p-4 rounded-xl text-xs space-y-1">
                    <div class="flex justify-between"><span>Belanja:</span><span id="checkoutSubtotal">Rp 0</span></div>
                    <div class="flex justify-between"><span>Layanan:</span><span id="checkoutService">Rp 0</span></div>
                    <div class="flex justify-between"><span>Ongkir:</span><span id="checkoutShipping">Rp 0</span></div>
                    <div class="flex justify-between font-bold text-blue-800 text-sm pt-1 border-t"><span>Total Akhir:</span><span id="checkoutGrandTotal">Rp 0</span></div>
                </div>

                <button onclick="processWhatsAppCheckout()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg">Kirim Order via WhatsApp</button>
            </div>
        </div>
    </div>

    <script>
        const ONG_PER_KM = 2500;
        const SERVICE_FEE = 1500;
        const BANK_INFO = "BCA 1234567890 a/n E-StarMart Official";
        const WA_NUMBER = "6281234567890"; // Ganti dengan nomor WhatsApp Anda
        
        const categories = ["All", "Streaming", "Paket Sayuran", "Makanan Berat", "Minuman"];
        let currentCategory = "All";
        let products = [];
        let cart = [];

        function generateData() {
            // Produk Streaming
            const streamingApps = ["Netflix", "YouTube", "Spotify", "Disney+", "Viu", "Prime Video", "iQIYI", "WeTV", "Vidio.com"];
            streamingApps.forEach(app => {
                products.push({
                    id: `str-1m-${app.toLowerCase().replace(/\./g, '')}`,
                    name: `${app} Premium 1 Bulan`,
                    category: "Streaming",
                    price: 40000,
                    digital: true
                });
                products.push({
                    id: `str-3m-${app.toLowerCase().replace(/\./g, '')}`,
                    name: `${app} Premium 3 Bulan`,
                    category: "Streaming",
                    price: 80000,
                    digital: true
                });
            });

            // Paket Sayuran
            const vege8k = ["Sop", "Sayur Asem", "Capcay", "Sayur Lodeh"];
            vege8k.forEach((item, idx) => {
                products.push({
                    id: `vege-8k-${idx}`,
                    name: `Paket ${item} Segar`,
                    category: "Paket Sayuran",
                    price: 8000,
                    digital: false
                });
            });

            // Makanan Berat
            const foodList = ["Mie Djimat", "Nasi Goreng", "Kwetiau", "Soto Ayam", "Bubur Ayam", "Mie Ayam"];
            foodList.forEach((item, idx) => {
                products.push({
                    id: `food-15k-${idx}`,
                    name: item,
                    category: "Makanan Berat",
                    price: 15000,
                    digital: false
                });
            });

            // Minuman
            const drinkList = ["Es Jeruk", "Es Teh", "Le Minerale"];
            drinkList.forEach((item, idx) => {
                products.push({
                    id: `drink-${idx}`,
                    name: item,
                    category: "Minuman",
                    price: 5000,
                    digital: false
                });
            });
        }

        function renderTabs() {
            const container = document.getElementById('categoryTabs');
            container.innerHTML = categories.map(cat => `
                <button onclick="setActiveCategory('${cat}')" 
                    id="tab-${cat.replace(/\s+/g, '-')}"
                    class="flex-none bg-white px-5 py-2.5 rounded-xl shadow-sm border border-gray-100 hover:border-blue-500 hover:text-blue-600 font-bold text-xs transition uppercase tracking-wider ${cat === currentCategory ? 'cat-active' : ''}">
                    ${cat === 'All' ? '‚≠ê Semua Menu' : cat}
                </button>
            `).join('');
        }

        function setActiveCategory(cat) {
            currentCategory = cat;
            renderTabs();
            renderProducts();
            window.scrollTo({ top: 280, behavior: 'smooth' });
        }

        function renderProducts(filteredList = null) {
            const grid = document.getElementById('productGrid');
            const header = document.getElementById('categoryHeader');
            let displayList = filteredList || products;
            if (!filteredList && currentCategory !== "All") {
                displayList = products.filter(p => p.category === currentCategory);
            }
            header.innerHTML = `
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-800 border-l-4 border-blue-600 pl-3 uppercase">
                        ${currentCategory === 'All' ? 'Koleksi E-StarMart' : currentCategory}
                    </h3>
                    <span class="text-xs text-gray-400 bg-gray-100 px-3 py-1 rounded-full font-bold">${displayList.length} Item</span>
                </div>
            `;
            grid.innerHTML = displayList.map(p => `
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4 product-card flex flex-col justify-between">
                    <div class="mb-3">
                        <span class="text-[9px] uppercase tracking-tighter text-blue-400 font-bold block mb-1">${p.category}</span>
                        <h4 class="font-bold text-xs text-gray-800 leading-tight mb-1 h-8 overflow-hidden line-clamp-2">${p.name}</h4>
                        <p class="text-blue-700 font-extrabold text-sm">Rp ${p.price.toLocaleString('id-ID')}</p>
                    </div>
                    <button onclick="addToCart('${p.id}')" class="w-full bg-blue-50 text-blue-700 border border-blue-200 py-2.5 rounded-lg hover:bg-blue-600 hover:text-white transition text-[10px] font-bold uppercase">
                        + Tambahkan
                    </button>
                </div>
            `).join('');
        }

        function searchProduct() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => p.name.toLowerCase().includes(q));
            renderProducts(filtered);
        }

        function toggleCart() { document.getElementById('cartSidebar').classList.toggle('translate-x-full'); }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const inCart = cart.find(item => item.id === id);
            inCart ? inCart.qty++ : cart.push({ ...product, qty: 1 });
            updateCart();
            showToast(product.name);
        }

        function updateCart() {
            const container = document.getElementById('cartItems');
            const subtotalEl = document.getElementById('cartSubtotal');
            const serviceEl = document.getElementById('cartServiceFee');
            const totalDisplay = document.getElementById('cartTotalDisplay');
            const countEl = document.getElementById('cart-count');
            
            container.innerHTML = '';
            let subtotal = 0;
            let count = 0;

            if (cart.length === 0) {
                container.innerHTML = '<div class="text-center py-20 opacity-30 flex flex-col items-center"><i class="fas fa-shopping-cart text-4xl mb-3"></i><p class="text-xs font-bold">Keranjang kosong</p></div>';
            } else {
                cart.forEach(item => {
                    subtotal += item.price * item.qty;
                    count += item.qty;
                    container.innerHTML += `
                        <div class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex items-center justify-between">
                            <div class="flex-grow pr-3">
                                <h5 class="text-[10px] font-bold text-gray-700 leading-tight">${item.name}</h5>
                                <p class="text-[10px] text-blue-600 font-bold mt-1">Rp ${(item.price * item.qty).toLocaleString('id-ID')}</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="changeQty('${item.id}', -1)" class="text-gray-300 hover:text-red-500 transition"><i class="fas fa-minus-circle"></i></button>
                                <span class="text-xs font-bold w-4 text-center">${item.qty}</span>
                                <button onclick="changeQty('${item.id}', 1)" class="text-gray-300 hover:text-blue-500 transition"><i class="fas fa-plus-circle"></i></button>
                            </div>
                        </div>
                    `;
                });
            }
            subtotalEl.innerText = `Rp ${subtotal.toLocaleString('id-ID')}`;
            serviceEl.innerText = `Rp ${SERVICE_FEE.toLocaleString('id-ID')}`;
            totalDisplay.innerText = `Rp ${(subtotal + SERVICE_FEE).toLocaleString('id-ID')}`;
            countEl.innerText = count;
        }

        function changeQty(id, delta) {
            const item = cart.find(i => i.id === id);
            if (item) item.qty += delta;
            if (item && item.qty <= 0) cart = cart.filter(i => i.id !== id);
            updateCart();
        }

        function calculateShipping() {
            const onlyDigital = cart.length > 0 && cart.every(item => item.digital);
            const distInput = document.getElementById('shipDistance');
            let dist = parseFloat(distInput.value) || 0;
            if (onlyDigital) { dist = 0; distInput.value = 0; }
            
            const fee = dist * ONG_PER_KM;
            const subtotal = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            
            document.getElementById('shippingFeeDisplay').value = `Rp ${fee.toLocaleString('id-ID')}`;
            document.getElementById('checkoutSubtotal').innerText = `Rp ${subtotal.toLocaleString('id-ID')}`;
            document.getElementById('checkoutService').innerText = `Rp ${SERVICE_FEE.toLocaleString('id-ID')}`;
            document.getElementById('checkoutShipping').innerText = `Rp ${fee.toLocaleString('id-ID')}`;
            document.getElementById('checkoutGrandTotal').innerText = `Rp ${(subtotal + fee + SERVICE_FEE).toLocaleString('id-ID')}`;
        }

        function openCheckoutModal() {
            if (cart.length === 0) return;
            const onlyDigital = cart.every(item => item.digital);
            const shippingArea = document.getElementById('shippingArea');
            onlyDigital ? shippingArea.classList.add('hidden') : shippingArea.classList.remove('hidden');
            calculateShipping();
            document.getElementById('checkoutModal').classList.remove('hidden');
        }

        function closeCheckoutModal() { document.getElementById('checkoutModal').classList.add('hidden'); }

        function processWhatsAppCheckout() {
            const name = document.getElementById('custName').value;
            const addr = document.getElementById('custAddr').value;
            const dist = document.getElementById('shipDistance').value || 0;
            const method = document.querySelector('input[name="payMethod"]:checked').value;
            
            if (!name || !addr) {
                alert('Nama dan Alamat wajib diisi untuk konfirmasi.');
                return;
            }
            
            const subtotal = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
            const ongkir = dist * ONG_PER_KM;
            const grandTotal = subtotal + ongkir + SERVICE_FEE;
            
            const now = new Date();
            const dateStr = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            const orderId = `ESM-${Math.floor(Date.now()/1000)}`;

            let msg = `üõçÔ∏è *KONFIRMASI PESANAN E-STARMART*\n`;
            msg += `ID Pesanan: *#${orderId}*\n`;
            msg += `Tanggal: ${dateStr}\n`;
            msg += `-------------------------------------------\n\n`;
            
            msg += `üë§ *DATA PELANGGAN*\n`;
            msg += `‚Ä¢ Nama: ${name}\n`;
            msg += `‚Ä¢ Lokasi/Akun: ${addr}\n`;
            if (ongkir > 0) msg += `‚Ä¢ Jarak: ${dist} KM\n`;
            msg += `‚Ä¢ Pembayaran: *${method}*\n\n`;
            
            msg += `üì¶ *DAFTAR BELANJA*\n`;
            cart.forEach(item => {
                msg += `‚Ä¢ ${item.name} (${item.qty}x) - Rp ${(item.price * item.qty).toLocaleString('id-ID')}\n`;
            });
            
            msg += `\nüíµ *RINCIAN BIAYA*\n`;
            msg += `‚Ä¢ Subtotal: Rp ${subtotal.toLocaleString('id-ID')}\n`;
            msg += `‚Ä¢ Biaya Layanan: Rp ${SERVICE_FEE.toLocaleString('id-ID')}\n`;
            if (ongkir > 0) msg += `‚Ä¢ Ongkos Kirim: Rp ${ongkir.toLocaleString('id-ID')}\n`;
            msg += `-------------------------------------------\n`;
            msg += `üí∞ *TOTAL BAYAR: Rp ${grandTotal.toLocaleString('id-ID')}*\n\n`;
            
            if (method === "Transfer") {
                msg += `üè¶ *INSTRUKSI PEMBAYARAN*\n`;
                msg += `Silakan transfer ke rekening resmi kami:\n`;
                msg += `*${BANK_INFO}*\n`;
                msg += `_Mohon lampirkan bukti transfer setelah ini._\n\n`;
            } else {
                msg += `‚úÖ *PESANAN COD*\n`;
                msg += `Harap siapkan uang pas saat barang diterima.\n\n`;
            }
            
            msg += `Terima kasih telah berbelanja di *E-StarMart*! üôè‚ú®`;
            
            window.open(`https://wa.me/${085881583885}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function showToast(name) {
            const t = document.createElement('div');
            t.className = "fixed bottom-6 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-full text-xs z-[100] shadow-xl font-bold border-2 border-white animate-pulse";
            t.innerText = `‚≠ê Berhasil ditambah: ${name}`;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 1200);
        }

        window.onload = () => {
            generateData();
            renderTabs();
            renderProducts();
        };
    </script>
</body>
</html>